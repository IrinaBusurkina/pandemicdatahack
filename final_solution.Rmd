---
title: "Уволить нельзя, нанять"
author: "Команда LOWWWFR"
date: "20 12 2020"
output:
  html_document:
    theme: cerulean
    highlight: monochrome
    toc: yes
    toc_float: yes
    toc_depth: 3
    number_sections: false
    code_folding: hide
---

# Введение

В 2020 году пандемия стало катализатором кризиса в экономике. Его острая фаза сопровождалась огромными потерями рабочих мест и росте безработицы по всей территории Российской Федерации. В это же время происходила быстрая перестройка трудовых процессов – как отдельным работникам, так и целым отраслям нужно было подстроиться под новую цифровую версию рынка. Изменился сам процесс найма и трудоустройства людей, сократилось количество вакантных мест, поменялись условия и график работы. Какие же факторы стали значимыми в этой гонке против безработицы?

Наше исследование представляет собой анализ общей картины безработицы по регионам Российской Федерации, которую нам могут предоставить данные. Сначала мы пытаемся выяснить, можно ли измерить уровень безработицы с помощью размера потока заявлений на признание статуса безработного, или же эти явления противоположны друг другу. В рамках этого вопроса нам интересно ответить на вопрос, по каким показателям похожи или различны регионы с высоким и низким потоком заявлений на пособие по безработице. Это поможет органам власти скорректировать региональную политику в отношении безработных, которые могут недополучать или излишне получать финансовую поддержку.

Кроме этого, мы спускаемся на уровень ниже – нам интересно выяснить, какие стратегии выбирают для себя люди на рынке труда во время пандемии. С помощью количественного анализа трансферов людей разных возрастных групп (выпускников, людей со стажем и граждан предпенсионного возраста) из различных отраслей хозяйства, нам важно понять, какие сферы деятельности и профессии стали невостребованными во время пандемии, а какие обрели свою популярность. С помощью этого анализа центры и службы занятости населения субъектов РФ смогут определить, в какие отрасли и профессии необходимо направлять людей на переобучение в первую очередь.

В качестве данных для анализа использована база данных “Безработные - 1”, которая включает в себя административную информацию, на основании которой принималось решение о признании граждан безработными. Единицей наблюдения является личное дело заявителя, который был официально признан безработным с 1 марта по 30 сентября 2020 года. Помимо этого, в анализ были включены данные из Росстата о социально-экономическом состоянии регионов во время пандемии. Так как не вся официальная статистика за первые несколько кварталов 2020 года общедоступна уже сейчас, то мы отобрали несколько переменных, которые влияют на непосредственное финансовое благосостояние трудоспособных граждан по субъектам Российской Федерации.

# Правда ли, что уровень безработицы равен потоку заявлений на получение статуса безработного?

```{r warning = F, message = F}
library(foreign)
library(dplyr)
library(lubridate)
library(tidyverse)
library(ggplot2)
library(forcats)
library(ggrepel)
library(FactoMineR)
library(stringr)
library(reactable)
library(corrplot)

df1 <- read_csv2("unemployed_1_data.csv") %>%
  dplyr::mutate(month_unemployed = ym(month_unemployed),
         gender = as.factor(gender),
         jobless_category = as.factor(jobless_category),
         education = as.factor(education),
         education_speciality = as.factor(education_speciality),
         prof_education_dur = as.numeric(str_replace_all(prof_education_dur, " ", "")),
         work_napravl_number = as.numeric(str_replace_all(work_napravl_number, " ", "")),
         work_napravl_refusal_number = as.numeric(str_replace_all(work_napravl_refusal_number, " ", "")),
         work_refusal_number = as.numeric(str_replace_all(work_refusal_number, " ", "")),
         employer_refusal_number = as.numeric(str_replace_all(employer_refusal_number, " ", "")),
         week_employment = as.numeric(str_replace_all(week_employment, " ", "")),
         region = as.factor(region),
         district = as.factor(district),
         dismissal_reason = as.factor(dismissal_reason),
         employment_type = as.factor(employment_type),
         employment_mode = as.factor(employment_mode),
         expected_salary = as.numeric(str_replace_all(expected_salary, " ", "")),
         salary_average = as.numeric(str_replace_all(salary_average, " ", "")),
         profession_employment = as.factor(profession_employment),
         profession_last_educ = as.factor(profession_last_educ),
         profession_last_work = as.factor(profession_last_work),
         reason_close = as.factor(reason_close),
         reason_end = as.factor(reason_end),
         month_jobless = ym(month_jobless),
         month_end_busyness = ym(month_end_busyness),
         month_employment = ym(month_employment),
         month_dismissal = ym(month_dismissal),
         month_close = ym(month_close),
         month_end = ym(month_end),
         experience = as.numeric(experience),
         age = as.factor(age / 100))
```

В первую очередь, по каждому региону нами было подсчитано количество уникальных заявлений на присвоение статуса безработного, которое затем было нормировано на численность рабочей силы в каждом регионе Российской Федерации (Рис. 1). Выше медианного значения находятся 10 регионов, первыми из которых являются г. Москва, Московская область и Краснодарский край.

```{r}
knitr::include_graphics("./top_reg_median.jpg")
```

Мы можем предположить, что в этих регионах может наблюдаться высокий уровень безработицы среди населения. Чтобы наглядно показать распределение уровня безработицы по регионам РФ, мы представили его в виде карты (Рис. 2).

```{r}
knitr::include_graphics("./unemployment_map.jpg")
```

Из данного представления видно, что республика Тыва и регионы южных федеральных округов являются наиболее пострадавшими от безработицы в период пандемии. Ни один из этих регионов не входит в топ регионов по количеству заявлений по безработице.

Посмотрим, в каких региона заявителя являются самыми активными (Рис. 2). В этот список входят г. Москва, Краснодарский край и Ростовская область, Республика Дагестан и Чеченская область, Республика Башкортостан, Свердловская область и регионы Сибири.

```{r}
knitr::include_graphics("./unemployment_map_norm.jpg")
```

Итак, с помощью карт мы можем наглядно представить расхождение между официально зарегистрированным уровнем безработицы и количеством людей, которые по той или иной причине стремятся получить статус безработного. Попытаемся понять, какие причины могли привести к такой разнице. Для этой цели мы привлечем сторонние количественные данные, которые могут помочь распутать данную проблему.

Первые и немаловажные показатели – данные по распространению числа заболеваний (источник – платформа Стопкоронавирус.рф). На карте совмещено три слоя: первый – летальность, %, второй - число заражений на 100К населения, третий - сумма смертей за весь период времени.


```{r}
knitr::include_graphics("./coronavirus_map.png")
```

Москва, все южные регионы, Санкт-Петербург и Ленинградская область, Мурманская область, Красноярский край, Республика Тыва, а также дальневосточные регионы наиболее сильно подвержены заражению и смертности населения от коронавируса. Практически все эти регионы входят в двадцатку по количеству зарегистрированных заявлений по безработице (см. Рис. 1). Это может говорить о том, что официальные данные не могут оперативно отразить изменения на рынке труда, и тогда экономическим последствиям коронавируса подвержены не те регионы, которые поддерживают высокий уровень безработицы.

Посмотрим на источники информации, которые люди использовали во время поиска справки по пособию по безработице. Первый из них в быстро развивающейся информационной среде это поисковые системы. Мы рассмотрим пример поисковых запросов в Google за период 1 марта - 30 сентября по словам “пособие по безработице” по регионам РФ. Данные взяты из открытого источника Google Trends.

В пятерку регионов, которые проявили самый большой интерес к данной теме, снова входят южные регионы, а также Республика Алтай и Еврейский автономный округ (Рис. 4).

```{r}
knitr::include_graphics("./popularity.png")
```

Альтернативными поисковыми запросами были попытки найти информацию о портале “Работа в России” и “пособие по безработице коронавирус”, что может также свидетельствовать о том, в каких регионах коронавирус сильно повлиял на трудовую ситуацию.

Если мы рассмотрим другой источник информации – региональные и центральные СМИ, то пик упоминаний слов “пособие по безработице” в новостных подводках приходится на весну 2020 г. Источник информации - портал данных СМИ Public.ru.

Вверху списка регионов, где тема пособий чаще всего освещена в СМИ, вновь возникает Москва, Санкт-Петербург, Свердловская область, Татарстан, районы Сибири и Юга России.

```{r}
knitr::include_graphics("./smi.png")
```

Таким образом, распространению количества заявления на статус безработного может влиять не только эпидемиологическая ситуация, но также и доступ людей к информационным источникам и широкое освещение темы в СМИ.

# По каким показателям похожи или различны регионы с высоким и низким потоком заявлений на пособие по безработице?

В этом разделе мы используем метод главных компонентов (PCA), также известный как известный как метод уменьшения размерности, который используется для объяснения различий между отдельными категориями в наборе данных. Для нашего набора данных мы собрали следующие переменные:

* **perc_unmpl** - уровень безработицы населения в возрасте 15-72 лет по субъектам Российской Федерации, в среднем за март-октябрь 2020 года (источник – Росстат)
* **level_empl** - уровень занятости населения в возрасте 15-72 лет по субъектам Российской Федерации, в среднем за март-октябрь 2020 года (источник – Росстат)
* **proz_minimum** - величина прожиточного минимума, установленная в субъектах Российской Федерации в соответствии с законом «О прожиточном минимуме в Российской Федерации», за II квартал 2020 года, для всех граждан (источник – Росстат)
* **work_min** - величина прожиточного минимума, установленная в субъектах Российской Федерации в соответствии с законом «О прожиточном минимуме в Российской Федерации», за II квартал 2020 года, категория трудоспособного населения (источник – Росстат)
* **price_fix** - стоимость фиксированного набора потребительских товаров и услуг в июне 2020 года, рублей (источник – Росстат)
* **prices_index** - индекс потребительских цен, июнь 2020 г.  в % к декабрю 2019 года (источник – Росстат)
* **salary_nom** - среднемесячная номинальная начисленная заработная плата работников по полному кругу организаций  по субъектам Российской Федерации с мая по сентябрь 2020 года (источник – Росстат)
* **population_trud** - численность рабочей силы в возрасте 15 лет и старше по субъектам Российской Федерации, в среднем за март-октябрь 2020 года (источник – Росстат)

В нашем наборе данных переменные сильно различаются по шкале (проценты, абсолютные и относительные величины), поэтому перед анализом мы шкалировали все переменные, чтобы минимизировать сумму квадратов. Так как основная цель PCA – уменьшить размерность, в дальнейшем анализе мы будем интерпретировать содержательно только два первых измерения, которые объясняют соответственно около 40% и 30% процентов от общей дисперсии.

В первую очередь, посмотрим на факторную карту переменных, которая представляет собой проекцию наблюдаемых переменных, спроецированных на плоскость, охватываемую первыми двумя главными компонентами. Это показывает нам структурную взаимосвязь между переменными и компонентами. Проекция вектора переменной позволяет нам посмотреть корреляцию между переменной и компонентом.

Идея графика на Рис. 7 – показать, в каком направлении коррелируют переменные. Ось, которая представляет Dim 1 и Dim 2, представляет собой коэффициент корреляции Пирсона, который изменяется от -1 до 1.

```{r}
#load("regions_data.rdata")

#region_names = as.data.frame(regions[,1])
#regions$regions = rownames(regions)
#res = PCA(regions, scale.unit = TRUE, quali.sup = c(1), ncp = 5, graph = T)

#summary(res)

#res$eig

#help(plot.PCA)

#df = data.frame(res$eig)
#plot(df$eigenvalue, type = 'h')

# Now let's plot the Variable factor map
#plot.PCA(res, axes=c(1, 2), choix="var", habillage=2)

#res$var$contrib

#res.hcpc<-HCPC(res ,nb.clust=4,consol=TRUE,min=4,max=10,graph=TRUE)
# I choose to divide the countries in 4 cluster in order to see which countries go together

#res.hcpc$desc.var

#cluster = data.frame(res.hcpc$data.clust)
#cluster1 = merge(x = cluster, y = okruga, by = "region", all.x = TRUE)

#head(cluster)

#df = data.frame(res.hcpc$call$X)
#head(df)
#df$regions = rownames(df)
#df1 = merge(x = df, y = regions, by = "regions", all.x = TRUE)
#df1$region = str_remove(df1$region, "область")
#df1$region = str_remove(df1$region, "Республика")

#ggplot(df1, aes(Dim.1, Dim.2)) + 
  #geom_text_repel(aes(label = region)) +
  #geom_point(aes(col = clust)) +
  #geom_text(aes(label = region), hjust = 0, vjust = 0) +
  #scale_y_log10() +
  #facet_wrap(~clust) +
  #scale_x_log10() + 
  #theme_bw()

knitr::include_graphics("./pca_dim.png")
```

## Первое измерение

Мы читаем его справа налево, начиная с самых связанных между собой показателей. В качестве примера мы видим, что уровень занятости и среднемесячная номинальная заработная плата имеют сильную корреляцию по первому измерению (около 0,8). В то же время индекс потребительских цен и уровень безработицы отрицательно коррелируют с этой осью.

Это можно интерпретировать следующим образом: регионы с высоким уровнем занятости и высокой среднемесячной номинальной заработной платой противоположны регионам с высоким индексом потребительских цен и высоким уровнем безработицы.

## Второе измерение

Читаем соотношение снизу вверх. Численность рабочей силы имеет высокую положительную корреляцию с числом заявок на признание статуса безработного (нормированное на численность рабочей силы). Ненормированное число заявлений также связано с этими переменными.

Небольшую негативную корреляцию с этими переменными имеют стоимость фиксированного набора потребительских товаров и услуг, и величина прожиточного минимума. 

Это можно интерпретировать следующим образом: регионы с высокой численностью трудоспособного населения и большим количеством заявлений по безработице противоположны регионам с высокой стоимостью набора потребительских товаров и с высоким прожиточным минимумом.

Такая интерпретация позволяет нам понять, каков вклад каждой переменной в построение этих двух измерений, или по-другому осей.

Теперь предположим, что мы хотим понять, как эти переменные влияют на сходство регионов. Для этого мы создадим группы регионов с помощью алгоритма иерархической кластеризации, где соберем вместе регионы, чтобы понять, на каком основании они могут объединяться (Рис. 8).

```{r}
knitr::include_graphics("./pca.png")
```

* **Cluster 1**: В первом и самом обширном кластере представлено 16 регионов из Центрального округа, 7 регионами из Приволжского округа, 7 регионами из Северо-Западного федерального округа, а также немногочисленными регионами из других округов. Их общие характеристики: высокий индекс потребительских цен, низкий прожиточный минимум и низкое число заявлений на признание статуса безработного (нормированное).
* **Cluster 2**: Второй кластер представлен преимущественно Южным (7 регионов), Приволжским (5 регионов) и Сибирским (5 регионов). Их объединяет высокое число заявлений на признание статуса безработного (нормированное) и высокая численность трудового населения.
* **Cluster 3**: Здесь собрана группа регионов, которые относятся к Дальневосточному федеральному округу (8 регионов). В этом кластере собраны регионы с высоким прожиточным минимумом, стоимостью фиксированного набора потребительских товаров и услуг, высоким уровнем занятости населения и низким индексом потребительских цен. Низкими являются показатели числа заявлений (нормированное) и индекса потребительских цен.
* **Cluster 4**: В этом кластере особняком стоит город Москва. Она характеризуется высокой численностью трудоспособного населения, высоким числом заявлений (нормированных), высокой номинальной заработной платой, и умеренно высоким уровнем прожиточного минимума, уровнем занятости населения и стоимостью фиксированного набора потребительских товаров и услуг.

Этот график показывает, насколько разные регионы по первой и второй осям. Чем больше регион склоняется в сторону Dim1 (первого измерения), тем выше его корреляция с уровнем занятости и среднемесячной номинальной заработной платой.

Чем больше регион стремится к оси Dim2 (второму измерению), тем выше корреляция с численностью рабочей силы и числом заявок на признание статуса безработного (нормированное на численность рабочей силы).

Все эти результаты следует интерпретировать с определенной осторожностью, потому что два интерпретируемых нами измерения объясняют только около 70% расхождений между регионами. Однако, теперь мы можем явственно увидеть, что регионы с большим и маленьким количеством заявлений очень сильно различаются между собой по показателям трудоустройства и финансового благополучия граждан. Эти различия необходимо учитывать при расчете размера поддержки регионов в отношении безработицы. 

Как мы увидели на примерах карт, уровень безработицы и поток заявлений на признание статуса безработного – это два разных явления, которые могут протекать не одновременно друг с другом. Немного разобравшись в том, можем ли мы поставить знак равенства между уровнем безработицы и потоком заявлений на статус безработного, рассмотрим, кто те люди, которые подают свои документы. Распределение количества заявлений по категориям граждан, испытывающих трудности, показывает, что кроме тех, кто обратился вторично, большое количество подано людьми, которые ранее не работали, а также лицами предпенсионного возраста и многодетные родители (см. Рис. 6, источник – данные Безработные - 1).

```{r}
#df1 %>%
  #filter(hc_any == TRUE) %>%
  #mutate(category = ifelse(hc_repeat == TRUE, "hc_repeat",
                           #ifelse(hc_didnotwork == TRUE, "hc_didnotwork",
                                  #ifelse(hc_predpens == TRUE, "hc_predpens",
                                         #ifelse(hc_largefam == TRUE, "hc_largefam",
                                                #ifelse(hc_finisheducczn == TRUE, "hc_finisheducczn",
                                                       #ifelse(hc_divorced == TRUE, "hc_divorced",
                                                              #ifelse(hc_singleparent == TRUE, "hc_singleparent",
                                                                     #ifelse(hc_redundantworkers == TRUE, "hc_redundantworkers",
                                                                            #ifelse(hc_socialcontr == TRUE, "hc_socialcontr", NA)))))))))) %>%
  #filter(!is.na(category)) %>%
  #count(category) %>%
  #mutate(category = fct_reorder(category, n)) %>%
  #ggplot() +
  #geom_bar(aes(category, n), fill = "#80DAEB", stat = "identity") +
  #xlab("Категория незащищенных граждан") +
  #ylab("Количество заявлений") +
  #coord_flip() +
  #theme_bw()

knitr::include_graphics("./unprot_cat.PNG")
```

То есть, в числе основных заявителей оказались те слои населения, которые ранее не были активно задействованы в экономике хозяйств, оставались “в тени”. Это может в том числе объяснить расхождение между официальной статистикой и численностью заявлений. Но больше всего это может говорить о большой мобилизации ранее незанятых на рынке труда, что может привести к большой потребности в курсах **переквалификации населения**.

# Изменение профессиональных траекторий

Рано или поздно гражданин теряет статус безработного - по разным причинам - однако, как говорят данные, самой частой причиной является непосредственно трудоустройство. Поэтому, в этой части анализа, мы решили посмотреть как менялась карьерная траектория людей после того как они стали безработными в период пандемии.

```{r}
options(scipen = 9999)

df1$profession_last_work = str_trim(df1$profession_last_work, side = c("both", "left", "right"))
df1 = df1 %>% mutate(profession_category = "0")

df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Учетчик", "Документовед", "Главный бухгалтер, заместитель главного бухгалтера", "Бухгалтер", "Ревизор", "Кладовщик", "Секретарь, пресс-секретарь"), "Учет, налоги", profession_category))

#торговля
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Кассир","Продавец","Киоскер","Торговый представитель","Товаровед","Консультант","Оператор товарный", "Приемщик заказов"), "Торговля", profession_category))


#ресторанный бизнес
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Официант","Мойщик посуды","Повар","Шеф-повар","Бармен","Помощник кухонный","Заведующий производством (шеф-повар)","Кухонный рабочий","Бариста","Буфетчик"), "Ресторанный бизнес", profession_category))

#транспорт
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Контролер","Составитель поездов","Дежурный по железнодорожной станции","Бортпроводник","Составитель поездов","Транспорт финансовый, таможенный","Машинист бульдозера","Машинист (другое)","Инспектор","Экспедитор","Водитель автомобиля","Водитель(другое)","Водитель погрузчика","Монтер пути","Машинист электровоза, тепловоза","Проводник пассажирского вагона","Моторист (машинист)","Кондуктор","Моторист (машинист)","Проводник (другое)","Транспортировщик","Транспорт кредитный","Машинист погрузочной машины", "Машинист топливоподачи","Тракторист","Машинист насосных установок","Помощник машиниста", "Дорожный рабочий", "Водитель (другое)"), "Транспорт", profession_category))

#технологичсекая промышленность
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Диспетчер (в разных сферах, в т.ч. главный)","Машинист котельной установки","Оператор конфейерной линии","Укладчик, упаковщик","Токарь", "Штамповщик","Дефектоскопист","Весовщик","Отделочник","Электрослесарь","Диспетчер (в разных сферах, в т.ч. главный)","Регистратор","Истопник","Аппаратчик (различных технологических процессов)","Делопроизводитель","Инженер","Оператор животноводческих комплексов и механизированных ферм","Модельщик","Техник","Контролер качества","Фасовщик","Формовщик (другие категории)","Главный специалист","Электромонтер","Оператор газораспределительной станции","Монтажник по монтажу стальных и железобетонных конструкций","Регулировщик приборов и оборудования","Кочегар","Электромонтер","Резчик","Аппаратчик (различных технологических процессов)","Кузнец","Оператор заправочных станций","Заготовщик","Шлифовщик","Чистильщик","Горнорабочий","Газорезчик, газосварщик","Оператор моечной установки","Термист","Сыродел, сыросол","Дежурный пульта управления","Оператор расфасовочно-упаковочного автомата","Оператор по добыче нефти и газа","Зоотехник (в т.ч. главный)","Пробоотборщик","Облицовщик","Оператор видеозаписи","Оператор производственного участка","Оператор автоматических и полуавтоматических линий станков и установок","Оператор диспетчерской","Станочник (другое)","Изготовитель продукции","Фрезеровщик","Формовщик железобетонных изделий и конструкций","Энергетик","Обойщик","Осмотрщик","Жестянщик","Дезинфектор","Обрубщик","Ремонтировщик","Наборщик","Бурильщик","Расфасовщик","Оператор очистных сооружений и очистного оборудования","Съемщик изделий","Машинист моечной установки","Кровельщик","Оператор поста управления","Мойщик (другое)","Оператор механизированных и автоматизированных складов","Обработчик продукции","Оператор теплового пункта и тепловых сетей","Оператор видеонаблюдения","Дежурный (другое)","Полировщик","Аппаратчик (различных технологических процессов)","Оператор персональных компьютеров и печатного оборудования","Промышленность технологическая-конструктор, конструктор, чертежник","Станочник деревообрабатывающих станков","Помощник бурильщика капитального ремонта скважин, эксплуатационного и разведочного бурения скважин","Приемщик (другое)","Изолировщик","Комплектовщик","Наладчик","Монтажник систем вентиляции, кондиционирования воздуха, пневмотранспорта и аспирации","Контролер станочных и слесарных работ","Дробильщик","Механизатор","Машинист расфасовочно-упаковочных машин","Монтажник технологических трубопроводов","Печатник","Оператор установки, оборудования","Вязальщик (прутков и проволоки, схемных шгутов, кабелей и шнуров)","Приемщик (другое)","Механик","Станочник (другое)","Обвальщик","Машинист буровой установки","Электрогазосварщик","Сборщик","Монтажник","Инженер-конструктор, конструктор, чертежник","Заведующий складом","Оператор пульта управления","Оператор абонентского отдела","Референт","Электромонтажник","Плавильщик","Оператор станков с программным управлением","Электромеханик","Электросварщик","Оператор (другое)","Сортировщик","Оператор линии в производстве пищевой продукции","Приемщик товаров","Оператор котельной","Штукатур","Прессовщик","Бетонщик","Проходчик","Технолог","Столяр","Оператор на автоматических и полуавтоматических линиях в деревообработке","Главный инженер (все отрасли)","Маркировщик","Литейщик","Машинист конвейера","Загрузчик","Стропальщик","Монтажник технологического оборудования и связанных с ним конструкций"), "Промышленность технологическая ", profession_category))

#Медицина и здравоохранение
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Фармацевт","Логопед","Фельдшер","Акушер (акушерка)","Врач-стоматолог","Врач","Медицинский регистратор","Медицинская сестра (брат)","Санитар (санитарка)","Ветеринар (врач, фельдшер, санитар)","Психолог (в т.ч. медицинский)"), "Медицина и здравоохранение", profession_category))

#Услуги (Сервис)
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Грузчик","Охранник","Сторож","Уборщик","Садовник","Мойщик автомобилей","Няня","Сиделка","Дворник","Переводчик, лингвист","Аниматор","Другое по сервису и туризму","Библиотекарь (в т.ч. главный)","Портной","Массажист","Горничная","Кастелянша","Гардеробщик","Экскурсовод (включая гида-переводчика, организатора экскурсий)","Мойщик-уборщик подвижного состава","Мойщик (другое)","Флорист","Контролер контрольно-пропускного пункта","Лифтер","Оператор связи","Специалист по сервису и туризму","Приемосдатчик груза и багажа", "Оператор прачечной самообслуживания", "Телефонист"), "Услуги", profession_category))

#Легкая и пищевая промышленность
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Раскройщик","Электрик","Швея","Пекарь","Контроль качества","Фасовщик","Оператор на производстве продуктов питания","Закройщик","Кондитер, бисквитчик, шоколадчик, вафельщик","Директор (заведующий) предприятия общественного питания","Провизор","Оператор стиральных машин","Оценщик","Сушильщик","Гладильщик","Машинист компрессорных установок","Обработчик промышленной продукции","Формовщик колбасных изделеий","Формовщик теста","Оператор швейного оборудования", "Оператор машинного доения", "Оператор птицефабрик и механизированных ферм","Оператор свиноводческих комплексов и механизированных ферм", "Тестовод, тестомес","Оператор линии в производстве промышленной продукции"    ), "Легкая и пищевая промышленность", profession_category))

#Архитектура, строительство и недвижимость
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Производитель работ (прораб) (в строительстве)","Строитель (в т.ч. главный)","Архитектор (в т.ч главный)","Маляр","Риелтор","Плотник","Машинист бульдозера","Арматурщик","Сверловщик","Машинист экскаватора","Строитель (в т.ч. главный)","Слесарь","Каменщик","Машинист автокрана","Сварщик", "Архитектор (в т.ч. главный)","Рамщик"), "Архитектура, строительство и недвижимость", profession_category))

#География, недра, геология, геодезия
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Эколог (инженер по охране окружающей среды, техник)","Геолог, геодезист","Эколог (инженер по охране окружающей среды, техник)"), "География, недра, геология, геодезия", profession_category))

#Сельское, лесное и рыбное хозяйство
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Раскряжевщик","Дояр (доярка)","Чабан","Вальщик леса","Лесник", "Лесоруб","Рыбак, рыбовод","Виноградарь","Животновод","Птицевод","Овощевод", "Агроном (в т.ч. главный)"), "Сельское, лесное и рыбное хозяйство", profession_category))

#IT
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Финансовый аналитик","Администратор баз данных и сетей","Аналитик","Программист"), "IT", profession_category))

#Сми, издательская деятельность
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Мерчендайзер (специалист по продвижению продукции в торговых сетях)","Журналист, корреспондент, фотокорреспондент","Редактор"), "Сми, издательская деятельность", profession_category))

#Дизайн
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Дизайнер","Художник (другое)","Фотограф","Дизайнер (художник) компьютерной графики","Оформитель"), "Дизайн", profession_category))

#Стиль, мода, индустрия красоты
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Ювелир","Специалист по маникюру, педикюру, макияжу, косметолог","Визажист","Парикмахер"), "Стиль, мода, индустрия красоты", profession_category))

#Образование и педагогика
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Преподаватель в образовательном учреждении","Методист","Педагог дополнительного образования","Руководящий сотрудник школы","Сотрудник дошкольного образовательного учреждения","Преподаватель в школе","Педагог-организатор","Педагог-психолог","Помощник воспитателя","Воспитатель","Вожатый","Социальный педагог","Руководящий сотрудник дошкольного образовательного учреждения","Образование и педагогика (в т.ч. старший)", "Вожатый (в т.ч. старший)"), "Образование и педагогикa", profession_category))

#Наука
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Научный сотрудник (все области)","Научный сотрудник (все области)","Сотрудник лаборатории"), "Наука", profession_category))

#Искусство и культура
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Режиссер (в т.ч главный)","Музыкальный или художественный руководитель","Культорг","Хореограф","Аккомпаниатор, концертмейстер","Звукооператор, звукорежиссер","Артист (любого жанра)","Кинооператор","Искусство и культураанизатор","Авербандщик","Ассистент (балетмейстера, дирижера, звукорежиссера, звукооператора, кинорижессера, оператора телевидения, и т.п.)", "Культорганизатор"), "Искусство и культура", profession_category))

#Физическая культура, спорт, фитнес
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Букмекер","Инструктор, тренер","Спортсмен"), "Физическая культура, спорт, фитнес", profession_category))

#Юриспруденция
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Юрист"), "Юриспруденция", profession_category))

#Госслужба
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Специалист в государственном органе","Другое в государственном органе","Государственный инспектор (все сферы)","Советник","Сотрудник правовой или судебной системы","Социальный работник","Руководитель в органе власти","Инспектор кредитный", "Пожарный, спасатель", "Специалист по связям с общественностью", "Инспектор финансовый, таможенный", "Инженер по охране труда"), "Госслужба", profession_category))

#Другое
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Рабочий","Подсобный рабочий","Разнорабочий","Специалист","Мастер","Почтальон","Курьер","Промоутер","Помощник мастера","Агент (разные области)","Ведущий специалист","Эксперт", "Другое", "Архивариус, библиограф, хранитель фондов (в т.ч. главный)","Паспортист"), "Другое", profession_category))

#Управление персоналом, организация труда
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Директор (сфера): исполнительный","Директор (заведующий) филиала","Управляющий (другое)","Директор (заведующий) филиала","Директор (заведующий) предприятия розничной торговли|Руководитель группы (специализированной в прочих отраслях)","Руководитель группы (в промышленности)","Распределитель работ","Управляющий делами","Руководитель в группе (другое)","Директор (заведующий) предприятия розничной торговли","Управляющий (другое)","Руководитель проекта","Директор (заведующий) филиала","Руководитель группы (функциональной в прочих областях деятельности)|Руководитель группы (специализированной в прочих отраслях)","Начальник подразделения (управления, бюро, цеха, группы и т.д.)","Заведующий хозяйством","Другое по кадрам","Руководитель в группе (другое)","Комендант","Начальник отдела","Генеральный директор","Руководитель группы (функциональной в прочих областях деятельности)","Руководитель группы (специализированной в прочих отраслях)","Специалист по кадрам","Инспектор по кадрам","Начальник отдела в торговле","Супервайзер","Заместитель начальника отдела (все сферы)", "Заведующий (другое)","Начальник (другое)" , "Бригадир (все отрасли)" , "Руководитель группы (другое)","Начальник абонентского отдела"), "Управление персоналом, организация труда", profession_category))

#ANONYMIZATION
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("ANONYMIZATION"), "ANONYMIZATION", profession_category))

#Менеджмент, управление, предпринимательство
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Начальник участка","Администратор гостиницы (дома отдыха)","Директор (другие учреждения)","Директор (сфера): исполнительный","Директор (сфера): коммерческий, финансовый, по экономике","Администратор (в т.ч. магазина, зала, кинотеатра, службы приема и размещения, театра, суда, глаавный)","Предприниматель","Офис-менеджер","Менеджер","Маркетолог","Директор (управляющий) фирмы","Директор (сфера): другое"), "Менеджмент, управление, предпринимательство", profession_category))

#Экономика и финансы
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Другое банка","Экономист (в т.ч. ведущий, главный, инженер)", "Специалист банка"), "Экономика и финансы", profession_category))

#Учет, налоги
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Финансовый аналитик","Администратор баз данных и сетей","Аналитик","Программист"), "IT", profession_category))

#Логистика, склад
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Логистик"), "Логистика, склад", profession_category))

#Военная сфера
df1 = df1 %>% mutate(profession_category = ifelse(profession_last_work %in% c("Капитан","Матрос","Стрелок"), "Военная сфера", profession_category))

df1$profession_employment = str_trim(df1$profession_employment, side = c("both", "left", "right"))
df1 = df1 %>% mutate(employment_category = "0")

df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Учетчик", "Документовед", "Главный бухгалтер, заместитель главного бухгалтера", "Бухгалтер", "Ревизор", "Кладовщик", "Секретарь, пресс-секретарь"), "Учет, налоги", employment_category))

#торговля
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Кассир","Продавец","Киоскер","Торговый представитель","Товаровед","Консультант","Оператор товарный", "Приемщик заказов", "Мерчендайзер", "Агент (коммерческий, торговый, страховой и т.д.)"), "Торговля", employment_category))

#ресторанный бизнес
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Официант","Мойщик посуды","Повар","Шеф-повар","Бармен","Помощник кухонный","Заведующий производством (шеф-повар)","Кухонный рабочий","Бариста","Буфетчик"), "Ресторанный бизнес", employment_category))

#транспорт
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Контролер","Составитель поездов","Дежурный по железнодорожной станции","Инструктор","Бортпроводник","Составитель поездов","Транспорт финансовый, таможенный","Машинист бульдозера","Машинист (другое)","Инспектор","Экспедитор","Водитель автомобиля","Водитель(другое)","Водитель погрузчика","Монтер пути","Машинист электровоза, тепловоза","Проводник пассажирского вагона","Моторист (машинист)","Кондуктор","Моторист (машинист)","Проводник (другое)","Транспортировщик","Транспорт кредитный","Машинист погрузочной машины", "Машинист топливоподачи","Тракторист","Машинист насосных установок","Помощник машиниста", "Дорожный рабочий", "Водитель (другое)"), "Транспорт", employment_category))

#технологичсекая промышленность
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Диспетчер (в разных сферах, в т.ч. главный)","Машинист котельной установки","Оператор конфейерной линии","Укладчик, упаковщик","Токарь", "Штамповщик","Дефектоскопист","Весовщик","Отделочник","Электрослесарь","Диспетчер (в разных сферах, в т.ч. главный)","Регистратор","Истопник","Аппаратчик (различных технологических процессов)","Делопроизводитель","Инженер","Оператор животноводческих комплексов и механизированных ферм","Модельщик","Техник","Контролер качества","Фасовщик","Формовщик (другие категории)","Главный специалист","Электромонтер","Оператор газораспределительной станции","Монтажник по монтажу стальных и железобетонных конструкций","Регулировщик приборов и оборудования","Кочегар","Электромонтер","Резчик","Аппаратчик (различных технологических процессов)","Кузнец","Оператор заправочных станций","Заготовщик","Шлифовщик","Чистильщик","Горнорабочий","Газорезчик, газосварщик","Оператор моечной установки","Термист","Сыродел, сыросол","Дежурный пульта управления","Оператор расфасовочно-упаковочного автомата","Оператор по добыче нефти и газа","Зоотехник (в т.ч. главный)","Пробоотборщик","Облицовщик","Оператор видеозаписи","Оператор производственного участка","Оператор автоматических и полуавтоматических линий станков и установок","Оператор диспетчерской","Станочник (другое)","Изготовитель продукции","Фрезеровщик","Формовщик железобетонных изделий и конструкций","Энергетик","Обойщик","Осмотрщик","Жестянщик","Дезинфектор","Обрубщик","Ремонтировщик","Наборщик","Бурильщик","Расфасовщик","Оператор очистных сооружений и очистного оборудования","Съемщик изделий","Машинист моечной установки","Кровельщик","Оператор поста управления","Мойщик (другое)","Оператор механизированных и автоматизированных складов","Обработчик продукции","Оператор теплового пункта и тепловых сетей","Оператор видеонаблюдения","Дежурный (другое)","Полировщик","Аппаратчик (различных технологических процессов)","Оператор персональных компьютеров и печатного оборудования","Промышленность технологическая-конструктор, конструктор, чертежник","Станочник деревообрабатывающих станков","Помощник бурильщика капитального ремонта скважин, эксплуатационного и разведочного бурения скважин","Приемщик (другое)","Изолировщик","Комплектовщик","Наладчик","Монтажник систем вентиляции, кондиционирования воздуха, пневмотранспорта и аспирации","Контролер станочных и слесарных работ","Дробильщик","Механизатор","Машинист расфасовочно-упаковочных машин","Монтажник технологических трубопроводов","Печатник","Оператор установки, оборудования","Вязальщик (прутков и проволоки, схемных шгутов, кабелей и шнуров)","Приемщик (другое)","Механик","Станочник (другое)","Обвальщик","Машинист буровой установки","Электрогазосварщик","Сборщик","Монтажник","Инженер-конструктор, конструктор, чертежник","Заведующий складом","Оператор пульта управления","Оператор абонентского отдела","Референт","Электромонтажник","Плавильщик","Оператор станков с программным управлением","Электромеханик","Электросварщик","Оператор (другое)","Сортировщик","Оператор линии в производстве пищевой продукции","Приемщик товаров","Оператор котельной","Штукатур","Прессовщик","Бетонщик","Проходчик","Технолог","Столяр","Оператор на автоматических и полуавтоматических линиях в деревообработке","Главный инженер (все отрасли)","Маркировщик","Литейщик","Машинист конвейера","Загрузчик","Стропальщик","Монтажник технологического оборудования и связанных с ним конструкций"), "Промышленность технологическая ", employment_category))

#Медицина и здравоохранение
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Фармацевт","Логопед","Фельдшер","Акушер (акушерка)","Врач-стоматолог","Врач","Медицинский регистратор","Медицинская сестра (брат)","Санитар (санитарка)","Ветеринар (врач, фельдшер, санитар)","Психолог (в т.ч. медицинский)"), "Медицина и здравоохранение", employment_category))

#Услуги (Сервис)
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Грузчик","Охранник","Сторож","Уборщик","Садовник","Мойщик автомобилей","Няня","Сиделка","Дворник","Переводчик, лингвист","Аниматор","Другое по сервису и туризму","Библиотекарь (в т.ч. главный)","Портной","Массажист","Горничная","Кастелянша","Гардеробщик","Экскурсовод (включая гида-переводчика, организатора экскурсий)","Мойщик-уборщик подвижного состава","Мойщик (другое)","Флорист","Контролер контрольно-пропускного пункта","Лифтер","Оператор связи","Специалист по сервису и туризму","Приемосдатчик груза и багажа", "Оператор прачечной самообслуживания", "Телефонист"), "Услуги", employment_category))

#Легкая и пищевая промышленность
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Раскройщик","Электрик","Швея","Пекарь","Контроль качества","Фасовщик","Оператор на производстве продуктов питания","Закройщик","Кондитер, бисквитчик, шоколадчик, вафельщик","Директор (заведующий) предприятия общественного питания","Провизор","Оператор стиральных машин","Оценщик","Сушильщик","Гладильщик","Машинист компрессорных установок","Обработчик промышленной продукции","Формовщик колбасных изделеий","Формовщик теста","Оператор швейного оборудования", "Оператор машинного доения", "Оператор птицефабрик и механизированных ферм","Оператор свиноводческих комплексов и механизированных ферм", "Тестовод, тестомес","Оператор линии в производстве промышленной продукции"    ,"Обработчик пищевой продукции", "Изготовитель пищевых полуфабрикатов"), "Легкая и пищевая промышленность", employment_category))

#Архитектура, строительство и недвижимость
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Производитель работ (прораб) (в строительстве)","Строитель (в т.ч. главный)","Архитектор (в т.ч главный)","Маляр","Риелтор","Плотник","Машинист бульдозера","Арматурщик","Сверловщик","Машинист экскаватора","Строитель (в т.ч. главный)","Слесарь","Каменщик","Машинист автокрана","Сварщик", "Архитектор (в т.ч. главный)","Рамщик", "Прораб"), "Архитектура, строительство и недвижимость", employment_category))

#География, недра, геология, геодезия
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Эколог (инженер по охране окружающей среды, техник)","Геолог, геодезист","Эколог (инженер по охране окружающей среды, техник)"), "География, недра, геология, геодезия", employment_category))

#Сельское, лесное и рыбное хозяйство
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Раскряжевщик","Дояр (доярка)","Чабан","Вальщик леса","Лесник", "Лесоруб","Рыбак, рыбовод","Виноградарь","Животновод","Птицевод","Овощевод", "Агроном (в т.ч. главный)"), "Сельское, лесное и рыбное хозяйство", employment_category))

#IT
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Финансовый аналитик","Администратор баз данных и сетей","Аналитик","Программист", "Системный администратор"), "IT", employment_category))

#Сми, издательская деятельность
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Мерчендайзер (специалист по продвижению продукции в торговых сетях)","Журналист, корреспондент, фотокорреспондент","Редактор"), "Сми, издательская деятельность", employment_category))

#Дизайн
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Дизайнер","Художник (другое)","Фотограф","Дизайнер (художник) компьютерной графики","Оформитель"), "Дизайн", employment_category))

#Стиль, мода, индустрия красоты
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Ювелир","Специалист по маникюру, педикюру, макияжу, косметолог","Визажист","Парикмахер","Специалист по маникюру, педикюру, макияжу"), "Стиль, мода, индустрия красоты", employment_category))

#Образование и педагогика
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Преподаватель в образовательном учреждении","Методист","Педагог дополнительного образования","Руководящий сотрудник школы","Сотрудник дошкольного образовательного учреждения","Преподаватель в школе","Педагог-организатор","Педагог-психолог","Помощник воспитателя","Воспитатель","Вожатый","Социальный педагог","Руководящий сотрудник дошкольного образовательного учреждения","Образование и педагогика (в т.ч. старший)", "Вожатый (в т.ч. старший)","Преподаватель", "Воспитатель в дошкольном учреждении"), "Образование и педагогикa", employment_category))

#Наука
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Научный сотрудник (все области)","Научный сотрудник (все области)","Сотрудник лаборатории","Сотрудник в лаборатории"), "Наука", employment_category))

#Искусство и культура
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Режиссер (в т.ч главный)","Музыкальный или художественный руководитель","Культорг","Хореограф","Аккомпаниатор, концертмейстер","Звукооператор, звукорежиссер","Артист (любого жанра)","Кинооператор","Искусство и культураанизатор","Авербандщик","Ассистент (балетмейстера, дирижера, звукорежиссера, звукооператора, кинорижессера, оператора телевидения, и т.п.)", "Культорганизатор","Художественный или музыкальный руководитель" ), "Искусство и культура", employment_category))

#Физическая культура, спорт, фитнес
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Букмекер","Инструктор, тренер","Спортсмен", "Тренер","Инструктор по спорту, физкультуре" ), "Физическая культура, спорт, фитнес", employment_category))

#Юриспруденция
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Юрист"), "Юриспруденция", employment_category))

#Госслужба
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Специалист в государственном органе","Другое в государственном органе","Государственный инспектор (все сферы)","Советник","Сотрудник правовой или судебной системы","Социальный работник","Руководитель в органе власти","Инспектор кредитный", "Пожарный, спасатель", "Специалист по связям с общественностью", "Инспектор финансовый, таможенный", "Инженер по охране труда"), "Госслужба", employment_category))

#Другое
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Рабочий","Подсобный рабочий","Разнорабочий","Специалист","Мастер","Почтальон","Курьер","Промоутер","Помощник мастера","Агент (разные области)","Ведущий специалист","Эксперт", "Другое", "Архивариус, библиограф, хранитель фондов (в т.ч. главный)","Паспортист"), "Другое", employment_category))

#Управление персоналом, организация труда
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Директор (сфера): исполнительный","Директор (заведующий) филиала","Управляющий (другое)","Директор (заведующий) филиала","Директор (заведующий) предприятия розничной торговли|Руководитель группы (специализированной в прочих отраслях)","Руководитель группы (в промышленности)","Распределитель работ","Управляющий делами","Руководитель в группе (другое)","Директор (заведующий) предприятия розничной торговли","Управляющий (другое)","Руководитель проекта","Директор (заведующий) филиала","Руководитель группы (функциональной в прочих областях деятельности)|Руководитель группы (специализированной в прочих отраслях)","Начальник подразделения (управления, бюро, цеха, группы и т.д.)","Заведующий хозяйством","Другое по кадрам","Руководитель в группе (другое)","Комендант","Начальник отдела","Генеральный директор","Руководитель группы (функциональной в прочих областях деятельности)","Руководитель группы (специализированной в прочих отраслях)","Специалист по кадрам","Инспектор по кадрам","Начальник отдела в торговле","Супервайзер","Заместитель начальника отдела (все сферы)", "Заведующий (другое)","Начальник (другое)" , "Бригадир (все отрасли)" , "Руководитель группы (другое)","Начальник абонентского отдела", "Директор (управляющий) предприятия","Администратор" , "Заведующий отделом (отделением)"), "Управление персоналом, организация труда", employment_category))

#ANONYMIZATION
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("ANONYMIZATION"), "ANONYMIZATION", employment_category))

#Менеджмент, управление, предпринимательство
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Начальник участка","Администратор гостиницы (дома отдыха)","Директор (другие учреждения)","Директор (сфера): исполнительный","Директор (сфера): коммерческий, финансовый, по экономике","Администратор (в т.ч. магазина, зала, кинотеатра, службы приема и размещения, театра, суда, глаавный)","Предприниматель","Офис-менеджер","Менеджер","Маркетолог","Директор (управляющий) фирмы","Директор (сфера): другое"), "Менеджмент, управление, предпринимательство", employment_category))

#Экономика и финансы
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Другое банка","Экономист (в т.ч. ведущий, главный, инженер)", "Специалист банка"), "Экономика и финансы", employment_category))

#Логистика, склад
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Логистик"), "Логистика, склад", employment_category))

#Военная сфера
df1 = df1 %>% mutate(employment_category = ifelse(profession_employment %in% c("Капитан","Матрос","Стрелок"), "Военная сфера", employment_category))

#df1 %>%
  #count(reason_close) %>%
  #filter(reason_close != "None") %>%
  #mutate(reason_close = fct_reorder(reason_close, n)) %>%
  
  #ggplot() +
  #geom_bar(aes(reason_close, n), fill = "#80DAEB", stat = "identity") +
  #xlab("Причина снятия гражданина с учета") +
  #ylab("Количество наблюдений") +
  #coord_flip() +
  #theme_bw()

knitr::include_graphics("./reasons.PNG")
```

Все профессии в датасете были распределены между 27 отраслей. Далее, с помощью метода Пирсона, мы оценивали значимость различий между сферами деятельности (отраслями), в которой человек работал раньше и на какую работу подался во время пандемии. Чем больше коэффициент в методе Пирсона, тем больше человек пересекается в этой категории. На графиках это интенсивность синего цвета показывает положительную корреляцию между профессиями, когда как интенсивность красного - отрицательную.

```{r warning = FALSE}
chi <- table(df1$profession_category , df1$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")
M <- round(cor(chi),2)
#head(M,2)
#calculates bivariate Pearson correlations of variables measured with or without RR.
corrplot(M, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

Как мы можем увидеть на графике, люди очень активно переходят между сферами деятельности и стараются устроиться на работу. Тем не менее, корреляция очень низка для ресторанного бизнеса, что означает, что, возможно, эта сфера сильнее всего пострадала во время пандемии (бармен, повар, помощник повара, мойщик посуды).

## Переход внутри отраслей

В этом разделе мы прослеживаем динамику перемешений внутри выделенных отраслей.

### IT

```{r}
ot_it = df1 %>% select(profession_last_work,profession_employment, profession_category,employment_category,) %>% filter(profession_category == "IT" & employment_category == "IT") %>% select(1:2)

ot_it <- table(ot_it$profession_last_work,ot_it$profession_employment)

it <-round(cor(ot_it),2)
#calculates bivariate Pearson correlations of variables measured with or without RR.
corrplot(it, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.8, tl.cex = 0.8, tl.col = "red")
```

Программисты охотно занимают должность системных администраторов, также как и системные администраторы - должность программиста. Аналитики идут только в сферу аналитик.

### Ресторанный бизнес

```{r}
ot_res = df1 %>% select(profession_last_work,profession_employment, profession_category,employment_category,) %>% filter(profession_category == "Ресторанный бизнес" & employment_category == "Ресторанный бизнес") %>% select(1:2)

ot_res <- table(ot_res$profession_last_work,ot_res$profession_employment)
res <-round(cor(ot_res),2)

#calculates bivariate Pearson correlations of variables measured with or without RR.
corrplot(res, method = "color", addCoef.col="grey", order = "AOE", number.cex = 1, tl.cex = 1, tl.col = "red")
```

Положительные вероятности:
* Есть вероятность, что повар может пойти работать шеф-поваром, и наоборот.
* Ниже вероятность, что мойщик посуды может пойти работать кухонным помощниким, и наоборот.
* Также, из положительных вероятностей, что повар может пойти работать буфетчиком, и наоборот.

Нейтральные показатели между барменом и официантом, и между поваром и мойщиком посуды, что означает, что также зарегистрированы такие ситуации перехода.

### Услуги

```{r}
ot_us = df1 %>% select(profession_last_work,profession_employment, profession_category,employment_category,) %>% filter(profession_category == "Услуги" & employment_category == "Услуги") %>% select(1:2)

ot_us <- table(ot_us$profession_last_work,ot_us$profession_employment)
us <-round(cor(ot_us),2)

#calculates bivariate Pearson correlations of variables measured with or without RR.
corrplot(us, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.5, tl.cex = 0.5, tl.col = "red")
```

Достаточно высокий положительный коэффициент у уборщика в связки с сиделкой, что означает, что высока вероятность перехода между этими двумя профессиями.

Положительные коэффициенты также зафиксированы между охранником и контролером, и уборщиком и библиотекарем, уборщиком и оператором связи, дворником и сиделкой, дворником и уборщицей.

### Медицина и здравоохранение  

```{r}
ot_med = df1 %>% select(profession_last_work,profession_employment, profession_category,employment_category,) %>% filter(profession_category == "Медицина и здравоохранение" & employment_category == "Медицина и здравоохранение") %>% select(1:2)

ot_med <- table(ot_med$profession_last_work,ot_med$profession_employment)
m <-round(cor(ot_med),2)

#calculates bivariate Pearson correlations of variables measured with or without RR.
corrplot(m, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.5, tl.cex = 0.5, tl.col = "red")
```

Люди не склонны переходить между отраслями, только у медсестер/медбратьев между санитарами и санитаркой есть вероятность перехода.

### Менеджмент, управление, предпринимательство

```{r}
ot_me = df1 %>% select(profession_last_work,profession_employment, profession_category,employment_category,) %>% filter(profession_category == "Менеджмент, управление, предпринимательство" & employment_category == "Менеджмент, управление, предпринимательство") %>% select(1:2)

ot_me <- table(ot_me$profession_last_work,ot_me$profession_employment)
me <-round(cor(ot_me),2)

#calculates bivariate Pearson correlations of variables measured with or without RR.
corrplot(me, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.5, tl.cex = 0.5, tl.col = "red")
```

Взаимозаменяемые профессии, высокие показатели перехода между профессиями.

### География, недра, геология, геодезия 

Среди бывших географов нет тех, кто работает по своей профессии. Посмотрим, куда же они решили перейти.

```{r}
ot_ge = df1 %>% select(profession_last_work,profession_employment, profession_category,employment_category) %>% filter(profession_category == "География, недра, геология, геодезия" & profession_employment != "None") %>% select(1:2)

ot_ge %>% reactable(defaultColDef = colDef(minWidth = 140))
```

Здесь мы можем увидеть, что люди чаще всего *переходят* на позицию мастера, эксперта, специалиста, что объясняется более обобщенным названием своей профессии.
Пример: эколог-инженер -> инженер

### Вывод по оставшимся отраслям

Некоторые названия профессий взаимозаменяемы, поэтому в таких отраслях как представленные ниже, мы наблюдаем высокую корреляцию у, по сути, одинаковых профессий, либо соответсвующих иерархической системе(продвижение по карьере или падение)

- Учет, налоги: достаточно высокий положительный коэффициент только между бухгалтером и главным бухгалтером.
- Управление персоналом, организация труда: высокая корреляция среди администраторов и начальников, но вероятнее всего это из-за общих названий, которые вполне могут заменяться.
- Другое: высокая корреляция среди группы разнорабочих, подсобных рабочий, рабочего и группы другое, специалисты, ведущие специалисты и эксперты но вероятнее всего для первой группы это из-за общих названий, которые вполне могут заменяться, для второй группы - из-за слишком общего названия пула профессий, которых не было представлено для выбора, поэтому люди выбирали подобные опции.

Мало переменных для сравнения оказалось в таких отраслях как:

- Юриспруденция
- Логистика
- Экономика и финансы
- Наука
- Образование и педагогика
- Госслужба

Профессии, которые можно назвать взаимозаменяемыми высоко коррелируют в таких отраслях как:

- Физическая культура, спорт, фитнес: тренер и инструктор.
- Дизайн: между графическим дизайнером и обычным дизайнером. 
- Легкая и пищевая промышленность: высока вероятность перехода из профессии пекаря в изготовителя пищевых полуфабрикатов и между кондитером и изготовителя пищевых полуфабрикатов.
- Торговля: очень высокая вероятность перехода между профессиями у мерчендайзера и продавца, у продавца и кассира, у консультанта и продавца, у мерчендайзера и кассира, у мерчендайзера и консультанта.

Не переходят между профессиями в таких отраслях как:

- Стиль, мода, индустрия красоты
- Сельское, лесное и рыбное хозяйство  
- Военная сфера
- Искусство и культура

Такое разделение может объясняться высокой квалификацией, требуемой для профессий, в этих отраслях (стрелок vs моряк).

Своего рода уникальные наблюдения были обнаружены в таких отраслях как:

- Архитектура, строительство и недвижимость  
Положительные коэффициенты перехода между слесарем и сварщиком, и между слесарем и маляром, сварщиком и маляром, но всё же низка вероятность перехода.
- Транспорт
Очень высокая вероятность перехода между профессиями у экспедитора и водителя автомобиля, у инструктора и водителя автомобиля, у экспедитора и инструктора.
- Промышленность технологическая: профессии с приставкой "электро" дали небольшую положительную корреляцию, все остальные профессии из этой сферы слабо коррелируют. 

### Вывод

В заключении, люди совершают переход между профессиями, которые так или иначе легче освоить – переход в медицинскую или военную сферу маловероятен (тем не менее существует позитивная корреляция), когда как переход между менеджментом и управлением вполне осуществим, и соответственно, более вероятен. Также люди переходят из одной профессии в другую по иерархии самой профессии. Наиболее вероятно, что в период пандемии, это ниспадающее движение (из шеф повара в повара, из поваров в буфетчики).

## Траектории профессии в зависимости от возраста людей

В этом разделе, наша цель посмотреть на траектории профессии в зависимости от возраста людей

```{r}
df1$age = as.numeric(df1$age)
df1$age[df1$age >= 9] <- "9"
#unique(df1$age)
```

### 16-17 лет

```{r}
age1 = df1 %>% filter(age == 1)
aa1 = table(age1$profession_category , age1$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")

a1 <-round(cor(aa1),2)
corrplot(a1, method = "color", addCoef.col = "grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

В данной возрастной категории больше всего переходов совершается между такими отраслями как технологическая промышленность, транспорт, учет и налоги и другое.
Чуть слабее коррелируют, с выше перечисленными областями,ресторанный бизнес, торговля и услуги.

### 18-22 года

```{r}
age2 = df1 %>% filter(age == 2)
aa2 = table(age2$profession_category , age2$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")

a2 <-round(cor(aa2),2)
corrplot(a2, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

Здесь замечена высокая корреляция между всеми профессиями. Слабее корреляции только среди сельского, лесного, рыбного хозяйства с такой отраслью как ресторанный бизнес. Ресторанный бизнес в целом слабее коррелирует с другими переменами, что показывает, что люди редко переходят из остальных отраслей в ресторанный бизнес и наоборот.

### 23-27 лет

```{r}
age3 = df1 %>% filter(age == 3)
aa3 = table(age3$profession_category , age3$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")

a3 <-round(cor(aa3),2)
corrplot(a3, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

Для возрастной группы 28-32 мы получаем практически такую же картину. Наиболее популярны переходы между менеджментом и управлением персоналом, госслужбой и наукой. Слабее всего показатели перехода между всеми отраслями и сельского, рыбного и лесного хозяйства, между всеми отраслями и юриспруденцией.

### 33-37 лет

```{r}
age5 = df1 %>% filter(age == 5)
aa5 = table(age5$profession_category , age5$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")

a5 <-round(cor(aa5),2)
corrplot(a5, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

Наименее вероятно люди будут совершать переход в отрасль юриспруденции, ресторанного бизнеса, учета и налогов и **менеджмента, управления, предпринимательства**.

### 38-42 года

```{r}
age6 = df1 %>% filter(age == 6)
aa6 = table(age6$profession_category , age6$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")

a6 <-round(cor(aa6),2)
corrplot(a6, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

В данной возрастной категории меньше всего переходят между всеми индустриями и отраслями сельского, рыбного, лесного хозяйства, учета и налогов, индустрии красоты  и ресторанного бизнеса. Чаще всего люди могут переходить между госслужбой, другое, наукой, IT, экономикой, логистикой, искусством и управление персоналом.

Для категории **43-47 лет** слабее корреляции только среди сельского, лесного, рыбного хозяйства с такой отраслью как ресторанный бизнес. Ресторанный бизнес в целом слабее коррелирует с другими переменами, что показывает, что люди редко переходят из остальных отраслей в ресторанный бизнес и наоборот.

### 48-52 года

```{r}
age8 = df1 %>% filter(age == 8)
aa = table(age8$profession_category , age8$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")

a8 <-round(cor(aa),2)
corrplot(a8, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

Слабее всего коэффициенты перехода здесь со всеми отраслями и дизайном, с транспортом и сельским хозяйством. На второй план также отходят индустрия красоты, учет и налоги, торговля и медицина и здравоохранение - люди наименее склонны менять свою профессию таким образом.

### 53-61 

```{r}
age9 = df1 %>% filter(age == 9)
aa = table(age9$profession_category , age9$employment_category)
#assocplot(t(chi),  col = c("black", "red"), main = "Visualization of the Residuals")

a9 <-round(cor(aa),2)
corrplot(a9, method = "color", addCoef.col="grey", order = "AOE", number.cex = 0.2, tl.cex = 0.5, tl.col = "red")
```

Всё больше и больше отраслей с возрастом начинают показывать низкий коэффициент перехода (но до сих пор положительный). 

Больше всего коррелируют:

- госслужба, 
- экономика и финансы, 
- IT,
- управление персоналом, 
- менеджмент, 
- искусство и культура,
- другое.

### Вывод

В общем и целом, для каждого возрасте есть своя специфика карьерной траектории. Практически во все возрастные периоды меньше всего вероятность перехода между сельским, лесным и  рыбным хозяйством, и  юриспруденцией со всеми остальными отраслями.

# Какие факторы влияют на быстрое трудоустройство? 

Теперь нам интересно посмотреть, какие характеристики граждан помогали им быстрее находить работу - для каждого наблюдения мы рассчитали разницу между значениями week_unemployed и week_employment, измеренную в днях, т.е. сколько дней прошло с момента постановки на учет как безработного до непосредственного трудоустройства. Данная переменная стала целевой для регрессионной модели - так как она является дискретной величиной, мы применили пуассоновскую линейную регрессию. В качестве предикторов были выбраны образование индивида, основание незанятости, категория последней профессии, которой был занят гражданин, а также длительность профессионального обучения. Затем, мы отобрали уровни переменных, которые оказались статистически значимы и с коэффициентом, более отличным от нуля. Таким образом, получилось следующее распределение коэффициентов.

```{r}
#df1 <- df1 %>% dplyr::mutate(day_employment = df1$week_employment * 7)
#df1 <- df1 %>% dplyr::mutate(day_unemployed = df1$week_unemployed * 7)
#df1 <- df1 %>% dplyr::mutate(daydiff = as.integer(day_employment-day_unemployed))

#reg <- df1[,c("daydiff", "jobless_category", "education", "profession_category", "prof_education_dur")] %>%
  #filter(!is.na(daydiff))

#m1 <- glm(daydiff ~ jobless_category + education + profession_category + prof_education_dur, data = reg, family = "poisson")

#reg_est = summary(m1)

#reg_summ = as.data.frame(reg_est$coefficients) %>%
  #tibble::rownames_to_column() %>% 
  #filter(`Pr(>|z|)` < 0.05 & !(rowname %in% c("(Intercept)", "prof_education_dur"))) %>%
  #mutate(relation = ifelse(Estimate > 0, "Positive", "Negative"))

#reg_summ %>% 
  #mutate(rowname = fct_reorder(rowname, desc(Estimate))) %>% 
  #ggplot(aes(x = rowname, y = Estimate, color = relation)) + 
  #geom_point() +
  #labs(x = 'Predictor', y = 'Estimate') +
  #geom_segment(aes(xend = rowname, yend = 0)) +
  #coord_flip() +
  #theme_bw()

knitr::include_graphics("./estimates.PNG")
```

В целом, коэффициенты регрессии не превышают единицу в абсолютных значениях – и, тем не менее, мы можем рассмотреть два самых контрастных случая. Граждане, работавшие в сфере юриспруденции, находят работу быстрее почти на 0.75 дня быстрее, когда как те, кто работал в сфере искусства и культуры - на 0.25 дня дольше. Таким образом, разница между этими двумя категориями составляет целый день. Конечно, мы не можем заявлять о различиях в востребованности тех или иных специалистов и навыков при таких коэффициентах - возможно, даже они могут ввести в заблуждение за счет недостатка данных по определенным профессиональным категориям. Так, мы можем заключить, что различий в скорости трудоустройста между представителями различных профессиональных (и не только) групп не существует.

